(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     29795,        794]
NotebookOptionsPosition[     27747,        730]
NotebookOutlinePosition[     28081,        745]
CellTagsIndexPosition[     28038,        742]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}]], "Input",
 CellChangeTimes->{{3.722450668090548*^9, 3.72245066980941*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"xx", " ", "=", " ", 
    RowBox[{"Array", "[", 
     RowBox[{"x", ",", " ", "13", ",", " ", "0"}], "]"}]}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"array", " ", "of", " ", "all", " ", "states"}], " ", 
   "*)"}]}]], "Input",
 CellChangeTimes->{{3.722459686638425*^9, 3.7224597020688*^9}, 
   3.722611497633163*^9, 3.7226123004082947`*^9, {3.7226308345885963`*^9, 
   3.7226308482952843`*^9}, {3.722636706957403*^9, 3.722636729721458*^9}, 
   3.72263690818769*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"p", " ", "=", " ", 
    RowBox[{"Array", "[", 
     RowBox[{"x", ",", " ", "3", ",", " ", "0"}], "]"}]}], ";"}], "  ", 
  RowBox[{"(*", " ", 
   RowBox[{"position", " ", "in", " ", "world", " ", "coordinates"}], 
   "*)"}]}]], "Input",
 CellChangeTimes->{{3.7224506910233183`*^9, 3.722450712217806*^9}, 
   3.7226123010590076`*^9, {3.72263084981275*^9, 3.7226308591732197`*^9}, {
   3.722631238362938*^9, 3.7226312412741327`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"q", " ", "=", " ", 
    RowBox[{"Array", "[", 
     RowBox[{"x", ",", " ", "4", ",", " ", "3"}], "]"}]}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"quaternion", ",", " ", 
    RowBox[{"body", "-", "to", "-", "world"}]}], " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.722450722822276*^9, 3.722450740721487*^9}, 
   3.7226123020841427`*^9, 3.7226132809698887`*^9, 3.722613451289556*^9, {
   3.722630861244475*^9, 3.7226308658274918`*^9}, {3.722631243348215*^9, 
   3.7226312465443897`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"qv", " ", "=", " ", 
    RowBox[{"Array", "[", 
     RowBox[{"x", ",", " ", "3", ",", " ", "3"}], "]"}]}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"quaternion", " ", "imaginary"}], " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.7224671667061234`*^9, 3.722467229404623*^9}, 
   3.722612302919856*^9, {3.722630867219296*^9, 3.72263087981183*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"qw", " ", "=", " ", 
    RowBox[{"x", "[", "6", "]"}]}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"quaternion", " ", "real"}], " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.722467313740158*^9, 3.722467326437275*^9}, 
   3.7226123038702374`*^9, {3.72263088124501*^9, 3.722630889852476*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"v", " ", "=", " ", 
    RowBox[{"Array", "[", 
     RowBox[{"x", ",", " ", "3", ",", " ", "7"}], "]"}]}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"velocity", " ", "in", " ", "body", " ", "coordinates"}], 
   "*)"}]}]], "Input",
 CellChangeTimes->{{3.722450788713393*^9, 3.722450798737377*^9}, 
   3.7226123045828323`*^9, {3.722630891461998*^9, 3.722630899128374*^9}, {
   3.722631249579925*^9, 3.722631253387162*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"w", " ", "=", " ", 
    RowBox[{"Array", "[", 
     RowBox[{"x", ",", " ", "3", ",", " ", "10"}], "]"}]}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
   "angular", " ", "rates", " ", "in", " ", "body", " ", "coordinates"}], " ",
    "*)"}]}]], "Input",
 CellChangeTimes->{{3.722450801943502*^9, 3.7224508107746763`*^9}, 
   3.7226123055465813`*^9, 3.722613372663233*^9, 3.722613447271372*^9, {
   3.72263090160723*^9, 3.722630906443472*^9}, {3.722631255186255*^9, 
   3.722631258586432*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"uu", " ", "=", " ", 
    RowBox[{"Array", "[", 
     RowBox[{"u", ",", " ", "6", ",", " ", "0"}], "]"}]}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"array", " ", "of", " ", "THRUST", " ", 
    RowBox[{"(", 
     RowBox[{"not", " ", "rpm"}], ")"}], " ", "inputs"}], " ", 
   "*)"}]}]], "Input",
 CellChangeTimes->{{3.722459679099752*^9, 3.722459679668689*^9}, {
  3.722630908349144*^9, 3.722630920888927*^9}, {3.722631261777266*^9, 
  3.722631271599519*^9}}],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"z", " ", "=", " ", 
   RowBox[{
    RowBox[{"[", 
     RowBox[{
     "B_direcs", ",", " ", "B_levers", ",", " ", "reaction_coeffs", ",", " ", 
      "drag_lin", ",", " ", "drag_ang", ",", " ", "grav_world", ",", " ", 
      "mass", ",", " ", "inertia_upper"}], "]"}], ".", "flat"}]}], " ", 
  "*)"}]], "Input",
 CellChangeTimes->{{3.72245156805758*^9, 3.722451580331004*^9}, {
   3.7224516194736767`*^9, 3.722451708241115*^9}, {3.722451748721959*^9, 
   3.722451823704214*^9}, {3.722452159985042*^9, 3.722452162811096*^9}, {
   3.722452289704503*^9, 3.722452320343998*^9}, 3.722459779210093*^9, {
   3.7224612302454967`*^9, 3.722461238590293*^9}, {3.72246771151187*^9, 
   3.722467724439995*^9}, {3.7226117274349537`*^9, 3.722611739223995*^9}, {
   3.722622346406794*^9, 3.7226223481096478`*^9}, {3.722630932339629*^9, 
   3.722630978076704*^9}, {3.722638764121192*^9, 3.722638764516964*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"zz", " ", "=", " ", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"Symbol", "[", 
       RowBox[{"\"\<z\>\"", "<>", 
        RowBox[{"ToString", "@", "i"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "0", ",", "57"}], "}"}]}], "]"}]}], ";"}], "  ", 
  RowBox[{"(*", " ", 
   RowBox[{"array", " ", "of", " ", "all", " ", "parameters"}], " ", 
   "*)"}]}]], "Input",
 CellChangeTimes->{{3.7224609996865587`*^9, 3.722461027460301*^9}, {
   3.722627540860652*^9, 3.7226276100530367`*^9}, {3.722627643942993*^9, 
   3.7226276963082323`*^9}, 3.722627852336615*^9, 3.722627905494533*^9, {
   3.722630994275002*^9, 3.7226310027015533`*^9}, 3.722631527830722*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Bp", " ", "=", " ", GridBox[{
      {"z0", "z1", "z2", "z3", "z4", "z5"},
      {"z6", "z7", "z8", "z9", "z10", "z11"},
      {"z12", "z13", "z14", "z15", "z16", "z17"}
     }]}], ";"}], "  ", 
  RowBox[{"(*", " ", 
   RowBox[{
   "matrix", " ", "of", " ", "thruster", " ", "direction", " ", "vectors"}], 
   " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.722451885605245*^9, 3.7224519306649714`*^9}, {
   3.7224519934035378`*^9, 3.722452089892612*^9}, {3.722452144037724*^9, 
   3.722452154214264*^9}, {3.7224522056384287`*^9, 3.722452205966447*^9}, {
   3.722452449390767*^9, 3.7224524671525993`*^9}, {3.7224525162233067`*^9, 
   3.722452575659704*^9}, 3.722452688887108*^9, {3.722627754430125*^9, 
   3.72262780494202*^9}, {3.7226310062176437`*^9, 3.7226310188741083`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Bq", " ", "=", " ", GridBox[{
      {"z18", "z19", "z20", "z21", "z22", "z23"},
      {"z24", "z25", "z26", "z27", "z28", "z29"},
      {"z30", "z31", "z32", "z33", "z34", "z35"}
     }]}], ";"}], "  ", 
  RowBox[{"(*", " ", 
   RowBox[{"matrix", " ", "of", " ", "thruster", " ", "lever", " ", "arms"}], 
   " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.722452148998315*^9, 3.7224521524993*^9}, {
  3.72245219485966*^9, 3.722452220385404*^9}, {3.7224526307618713`*^9, 
  3.7224527099412746`*^9}, {3.722627776218272*^9, 3.722627808061903*^9}, {
  3.722631020571527*^9, 3.722631030796227*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Tc", " ", "=", " ", 
    RowBox[{"DiagonalMatrix", "[", 
     RowBox[{"{", 
      RowBox[{
      "z36", ",", " ", "z37", ",", " ", "z38", ",", " ", "z39", ",", " ", 
       "z40", ",", " ", "z41"}], "}"}], "]"}]}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
   "matrix", " ", "of", " ", "propeller", " ", "torque", " ", "reaction", " ",
     "coefficients"}], " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.722452344351624*^9, 3.7224524151270657`*^9}, {
   3.722452695788136*^9, 3.722452758237759*^9}, 3.722452826616598*^9, 
   3.722459533808614*^9, 3.72245977306846*^9, {3.722627778700981*^9, 
   3.722627839016342*^9}, {3.7226310321355658`*^9, 3.722631054794189*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Dl", " ", "=", " ", 
    RowBox[{"DiagonalMatrix", "[", 
     RowBox[{"{", 
      RowBox[{"z42", ",", " ", "z43", ",", " ", "z44"}], "}"}], "]"}]}], 
   ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
   "matrix", " ", "of", " ", "translational", " ", "drag", " ", 
    "coefficients"}], " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.722459140970008*^9, 3.722459176900275*^9}, {
   3.722459240612586*^9, 3.722459244173143*^9}, 3.722459535762415*^9, {
   3.722627779741912*^9, 3.722627830752076*^9}, {3.722631057471602*^9, 
   3.722631075058978*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Da", " ", "=", " ", 
    RowBox[{"DiagonalMatrix", "[", 
     RowBox[{"{", 
      RowBox[{"z45", ",", " ", "z46", ",", " ", "z47"}], "}"}], "]"}]}], 
   ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
   "matrix", " ", "of", " ", "angular", " ", "drag", " ", "coefficients"}], 
   " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.7224591854221773`*^9, 3.722459213496917*^9}, {
   3.7224592460530853`*^9, 3.722459248582109*^9}, 3.722459537426445*^9, {
   3.722627782509997*^9, 3.722627824728194*^9}, {3.722631077182995*^9, 
   3.7226310897850723`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"g", " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{"z48", ",", " ", "z49", ",", " ", "z50"}], "}"}]}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
   "local", " ", "gravity", " ", "acceleration", " ", "vector", " ", "in", 
    " ", "world", " ", "coordinates"}], " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.722459222835731*^9, 3.722459262923595*^9}, 
   3.7224595397269917`*^9, {3.722627783111504*^9, 3.7226278115920353`*^9}, {
   3.722631090974441*^9, 3.722631107982027*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"m", " ", "=", " ", "z51"}], ";"}], "  ", 
  RowBox[{"(*", " ", "mass", " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.7224592873901253`*^9, 3.72245929511726*^9}, 
   3.722459541569187*^9, 3.722461226694682*^9, {3.722627786096404*^9, 
   3.72262781337987*^9}, {3.722631109591052*^9, 3.722631112890079*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Ine", " ", "=", " ", GridBox[{
      {"z52", "z53", "z54"},
      {"z53", "z55", "z56"},
      {"z54", "z56", "z57"}
     }]}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"inertia", " ", "matrix", " ", 
    RowBox[{"(", "symmetric", ")"}]}], " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.722459301384657*^9, 3.722459388339259*^9}, {
   3.722459471600547*^9, 3.722459480421239*^9}, 3.722459542917688*^9, {
   3.7224612167203207`*^9, 3.722461217901012*^9}, {3.7224616060951157`*^9, 
   3.722461619651298*^9}, {3.7224621955468807`*^9, 3.7224622122406483`*^9}, {
   3.722462507121263*^9, 3.7224625095076942`*^9}, {3.7224636421743937`*^9, 
   3.7224636454005623`*^9}, {3.722627786513617*^9, 3.722627817148212*^9}, {
   3.722631114582075*^9, 3.722631137299505*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Fg", " ", "=", " ", 
    RowBox[{"m", "*", 
     RowBox[{"(", 
      RowBox[{"g", " ", "-", " ", 
       RowBox[{"qw", "*", "2", "*", 
        RowBox[{"Cross", "[", 
         RowBox[{"qv", ",", " ", "g"}], "]"}]}], " ", "+", 
       RowBox[{"Cross", "[", 
        RowBox[{"qv", ",", 
         RowBox[{"2", "*", 
          RowBox[{"Cross", "[", 
           RowBox[{"qv", ",", " ", "g"}], "]"}]}]}], " ", "]"}]}], ")"}]}]}], 
   ";"}], "  ", 
  RowBox[{"(*", " ", 
   RowBox[{
   "force", " ", "of", " ", "gravity", " ", "in", " ", "body", " ", 
    "coordinates"}], " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.722463677923027*^9, 3.7224636782328453`*^9}, {
   3.722466825314104*^9, 3.7224668263507757`*^9}, {3.722466962002968*^9, 
   3.7224669735668*^9}, {3.722467068096005*^9, 3.722467077876245*^9}, {
   3.7224671271256647`*^9, 3.722467142561255*^9}, {3.722467255279125*^9, 
   3.7224673039709263`*^9}, {3.722467339709815*^9, 3.72246738728067*^9}, {
   3.7224674173622217`*^9, 3.722467419335256*^9}, {3.722467489967124*^9, 
   3.722467490517956*^9}, 3.722467597779048*^9, {3.722611710134841*^9, 
   3.722611714955456*^9}, {3.722631142858617*^9, 3.7226311514821367`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"accl", " ", "=", " ", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"1", "/", "m"}], ")"}], "*", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"Bp", ".", "uu"}], "-", 
       RowBox[{"Dl", ".", "v"}], "+", "Fg"}], ")"}]}]}], ";"}], "  ", 
  RowBox[{"(*", " ", 
   RowBox[{
   "translational", " ", "acceleration", " ", "in", " ", "body", " ", 
    "coordinates"}], " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.722463546544745*^9, 3.722463559936247*^9}, {
  3.7226311605606613`*^9, 3.72263118408867*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"acca", " ", "=", " ", 
    RowBox[{
     RowBox[{"Inverse", "[", "Ine", "]"}], ".", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"Bq", ".", "uu"}], "+", 
       RowBox[{"Bp", ".", "Tc", ".", "uu"}], "-", 
       RowBox[{"Da", ".", "w"}], "-", 
       RowBox[{"Cross", "[", 
        RowBox[{"w", ",", " ", 
         RowBox[{"Ine", ".", "w"}]}], "]"}]}], ")"}]}]}], ";"}], "  ", 
  RowBox[{"(*", " ", 
   RowBox[{
   "angular", " ", "acceleration", " ", "in", " ", "body", " ", 
    "coordinates"}], " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.722463563863976*^9, 3.722463577136153*^9}, {
  3.722631187476205*^9, 3.722631197086379*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pdot", " ", "=", " ", 
    RowBox[{"v", " ", "+", " ", 
     RowBox[{"qw", "*", "2", "*", 
      RowBox[{"Cross", "[", 
       RowBox[{"qv", ",", " ", "v"}], "]"}]}], " ", "+", " ", 
     RowBox[{"Cross", "[", 
      RowBox[{"qv", ",", 
       RowBox[{"2", "*", 
        RowBox[{"Cross", "[", 
         RowBox[{"qv", ",", " ", "v"}], "]"}]}]}], " ", "]"}]}]}], ";"}], 
  "  ", 
  RowBox[{"(*", " ", 
   RowBox[{
   "translational", " ", "velocity", " ", "in", " ", "world", " ", 
    "coordinates"}], " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.7224726124868383`*^9, 3.722472702109902*^9}, {
  3.722631210760988*^9, 3.7226312340711403`*^9}, {3.722631540439641*^9, 
  3.722631540660046*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"qdot", " ", "=", " ", 
    RowBox[{"Flatten", "[", 
     RowBox[{"0.5", "*", GridBox[{
        {
         RowBox[{
          RowBox[{
           RowBox[{"x", "[", "3", "]"}], "*", "0"}], "+", 
          RowBox[{
           RowBox[{"x", "[", "4", "]"}], "*", 
           RowBox[{"x", "[", "12", "]"}]}], "-", 
          RowBox[{
           RowBox[{"x", "[", "5", "]"}], "*", 
           RowBox[{"x", "[", "11", "]"}]}], "+", 
          RowBox[{
           RowBox[{"x", "[", "6", "]"}], "*", 
           RowBox[{"x", "[", "10", "]"}]}]}]},
        {
         RowBox[{
          RowBox[{
           RowBox[{"-", 
            RowBox[{"x", "[", "3", "]"}]}], "*", 
           RowBox[{"x", "[", "12", "]"}]}], "+", 
          RowBox[{
           RowBox[{"x", "[", "4", "]"}], "*", "0"}], "+", 
          RowBox[{
           RowBox[{"x", "[", "5", "]"}], "*", 
           RowBox[{"x", "[", "10", "]"}]}], "+", 
          RowBox[{
           RowBox[{"x", "[", "6", "]"}], "*", 
           RowBox[{"x", "[", "11", "]"}]}]}]},
        {
         RowBox[{
          RowBox[{
           RowBox[{"x", "[", "3", "]"}], "*", 
           RowBox[{"x", "[", "11", "]"}]}], "-", 
          RowBox[{
           RowBox[{"x", "[", "4", "]"}], "*", 
           RowBox[{"x", "[", "10", "]"}]}], "+", 
          RowBox[{
           RowBox[{"x", "[", "5", "]"}], "*", "0"}], "+", 
          RowBox[{
           RowBox[{"x", "[", "6", "]"}], "*", 
           RowBox[{"x", "[", "12", "]"}]}]}]},
        {
         RowBox[{
          RowBox[{
           RowBox[{"-", 
            RowBox[{"x", "[", "3", "]"}]}], "*", 
           RowBox[{"x", "[", "10", "]"}]}], "-", 
          RowBox[{
           RowBox[{"x", "[", "4", "]"}], "*", 
           RowBox[{"x", "[", "11", "]"}]}], "-", 
          RowBox[{
           RowBox[{"x", "[", "5", "]"}], "*", 
           RowBox[{"x", "[", "12", "]"}]}], "+", 
          RowBox[{
           RowBox[{"x", "[", "6", "]"}], "*", "0"}]}]}
       }]}], "]"}]}], ";"}], "  ", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"quaternion", " ", "derivative"}], ",", " ", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"1", "/", "2"}], ")"}], "*", 
     RowBox[{"q", ".", "w"}]}]}], " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.722472903472044*^9, 3.7224729046502123`*^9}, {
   3.722612177141139*^9, 3.7226121913134108`*^9}, {3.7226128460359898`*^9, 
   3.722612868115817*^9}, {3.722613169507712*^9, 3.7226131992529*^9}, {
   3.7226134656154823`*^9, 3.722613482395587*^9}, 3.722613668739687*^9, {
   3.722614062334985*^9, 3.722614066981551*^9}, {3.722631301953742*^9, 
   3.722631333212062*^9}, {3.722631400251182*^9, 3.722631402615807*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"dyn", " ", "=", " ", 
    RowBox[{"Simplify", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Extract", "[", 
        RowBox[{"pdot", ",", "1"}], "]"}], ",", " ", 
       RowBox[{"Extract", "[", 
        RowBox[{"pdot", ",", "2"}], "]"}], ",", " ", 
       RowBox[{"Extract", "[", 
        RowBox[{"pdot", ",", "3"}], "]"}], ",", " ", 
       RowBox[{"Extract", "[", 
        RowBox[{"qdot", ",", " ", "1"}], "]"}], ",", " ", 
       RowBox[{"Extract", "[", 
        RowBox[{"qdot", ",", " ", "2"}], "]"}], ",", " ", 
       RowBox[{"Extract", "[", 
        RowBox[{"qdot", ",", " ", "3"}], "]"}], ",", " ", 
       RowBox[{"Extract", "[", 
        RowBox[{"qdot", ",", " ", "4"}], "]"}], ",", " ", 
       RowBox[{"Extract", "[", 
        RowBox[{"accl", ",", "1"}], "]"}], ",", " ", 
       RowBox[{"Extract", "[", 
        RowBox[{"accl", ",", "2"}], "]"}], ",", " ", 
       RowBox[{"Extract", "[", 
        RowBox[{"accl", ",", " ", "3"}], "]"}], ",", " ", 
       RowBox[{"Extract", "[", 
        RowBox[{"acca", ",", "1"}], "]"}], ",", " ", 
       RowBox[{"Extract", "[", 
        RowBox[{"acca", ",", "2"}], "]"}], ",", " ", 
       RowBox[{"Extract", "[", 
        RowBox[{"acca", ",", " ", "3"}], "]"}]}], "}"}], " ", "]"}]}], ";"}], 
  "  ", 
  RowBox[{"(*", " ", 
   RowBox[{"vector", " ", "dynamics", " ", "function"}], " ", 
   "*)"}]}]], "Input",
 CellChangeTimes->{{3.722460507638928*^9, 3.722460547666717*^9}, {
   3.722460648338334*^9, 3.722460844536511*^9}, {3.7224612421773863`*^9, 
   3.722461253626419*^9}, {3.722461304219462*^9, 3.722461308988967*^9}, 
   3.72246140051346*^9, {3.7224616235539*^9, 3.7224616252920933`*^9}, {
   3.722461657655467*^9, 3.722461684037039*^9}, {3.722461729923484*^9, 
   3.722461734853951*^9}, {3.7224618831970673`*^9, 3.722461887702182*^9}, {
   3.722462084729288*^9, 3.7224621177304277`*^9}, {3.722462366152337*^9, 
   3.722462465687731*^9}, {3.722462496840919*^9, 3.722462502739148*^9}, {
   3.722462570536199*^9, 3.7224626445237503`*^9}, {3.7224627015747147`*^9, 
   3.722462725263925*^9}, {3.722462756691115*^9, 3.722462777155026*^9}, {
   3.722462934326367*^9, 3.722462945242011*^9}, 3.7224630567295027`*^9, {
   3.722463095082849*^9, 3.722463106582678*^9}, {3.722463160901297*^9, 
   3.7224632155235367`*^9}, {3.7224632909425793`*^9, 
   3.7224633826868896`*^9}, {3.7224634270097227`*^9, 
   3.7224634332050657`*^9}, {3.7224634738435707`*^9, 3.722463513107389*^9}, {
   3.722463553468997*^9, 3.722463655633811*^9}, {3.7224727367772923`*^9, 
   3.722472778032193*^9}, {3.7224728089779463`*^9, 3.722472813301187*^9}, {
   3.722612167826047*^9, 3.7226121727021017`*^9}, {3.722613525830755*^9, 
   3.72261356254119*^9}, 3.7226140040410337`*^9, 3.722614088433074*^9, {
   3.722631410867931*^9, 3.722631433777804*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dyn", " ", "//", "MatrixForm"}], ";"}]], "Input",
 CellChangeTimes->{{3.722461742600871*^9, 3.722461750154195*^9}, {
   3.722462350013736*^9, 3.722462375306086*^9}, 3.7226147687874393`*^9, 
   3.722627874647769*^9, 3.722631522837428*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"A", " ", "=", " ", 
    RowBox[{"D", "[", 
     RowBox[{"dyn", ",", 
      RowBox[{"{", "xx", "}"}]}], "]"}]}], ";"}], "  ", 
  RowBox[{"(*", " ", 
   RowBox[{"dynamics", " ", "jacobian", " ", "wrt", " ", "state"}], " ", 
   "*)"}]}]], "Input",
 CellChangeTimes->{{3.722467755001664*^9, 3.7224677848563223`*^9}, {
  3.722471498338955*^9, 3.722471513898753*^9}, {3.722471543905555*^9, 
  3.722471588761704*^9}, {3.722613708083111*^9, 3.722613732576942*^9}, {
  3.722627873388344*^9, 3.722627897369836*^9}, {3.7226314398472767`*^9, 
  3.722631452229148*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"A", "//", "MatrixForm"}], ";"}]], "Input",
 CellChangeTimes->{{3.722613734352339*^9, 3.722613743970175*^9}, 
   3.722614783632835*^9, 3.722627902117318*^9, 3.72263151810491*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"B", " ", "=", " ", 
   RowBox[{"D", "[", 
    RowBox[{"dyn", ",", 
     RowBox[{"{", "uu", "}"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.722614386436163*^9, 3.7226143939198847`*^9}, {
  3.722629299379668*^9, 3.722629301093556*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"B", "//", "MatrixForm"}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"dynamics", " ", "jacobian", " ", "wrt", " ", "input"}], " ", 
   "*)"}]}]], "Input",
 CellChangeTimes->{{3.722614396256351*^9, 3.7226143985745277`*^9}, 
   3.722614469867622*^9, {3.722631455502977*^9, 3.7226314659947577`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Y", " ", "=", " ", 
    RowBox[{"D", "[", 
     RowBox[{"dyn", ",", " ", 
      RowBox[{"{", "zz", "}"}]}], "]"}]}], ";"}], "  ", 
  RowBox[{"(*", " ", 
   RowBox[{"dynamics", " ", "jacobian", " ", "wrt", " ", "parameters"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Y", "//", "MatrixForm"}], ";"}]}], "Input",
 CellChangeTimes->{{3.722612420446928*^9, 3.722612432395091*^9}, {
   3.722614403084095*^9, 3.7226144073947783`*^9}, 3.722614454887429*^9, {
   3.722631469879244*^9, 3.722631479289062*^9}}],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"verify", " ", "things"}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.722639254373889*^9, 3.7226392580748587`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Dimensions", "[", "dyn", "]"}]], "Input",
 CellChangeTimes->{3.722631600870571*^9}],

Cell[BoxData[
 RowBox[{"{", "13", "}"}]], "Output",
 CellChangeTimes->{
  3.722631603400866*^9, {3.722631787185507*^9, 3.722631794396903*^9}, 
   3.722635814775304*^9, 3.722636002894755*^9, {3.722636098080895*^9, 
   3.722636133744635*^9}, 3.722636542721669*^9, 3.72263691268636*^9, {
   3.722639235283657*^9, 3.7226392887476788`*^9}, 3.722640421333436*^9, 
   3.722642192435711*^9, 3.7226470032838984`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Dimensions", "[", "A", "]"}]], "Input",
 CellChangeTimes->{{3.722612250770273*^9, 3.722612262605801*^9}, 
   3.722614776393124*^9, 3.7226314892363157`*^9, 3.722631584567792*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"13", ",", "13"}], "}"}]], "Output",
 CellChangeTimes->{
  3.722631603476677*^9, {3.7226317872493773`*^9, 3.7226317944836206`*^9}, 
   3.722635814937908*^9, 3.722636002981908*^9, {3.7226360981985064`*^9, 
   3.7226361338500757`*^9}, 3.722636542898999*^9, 3.722636912797421*^9, {
   3.7226392353795633`*^9, 3.722639288860237*^9}, 3.722640421498596*^9, 
   3.722642192606086*^9, 3.722647003390239*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Dimensions", "[", "B", "]"}]], "Input",
 CellChangeTimes->{{3.7226122653372507`*^9, 3.722612268644642*^9}, 
   3.7226147773375463`*^9, 3.7226314880293713`*^9, 3.7226315861274853`*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"13", ",", "6"}], "}"}]], "Output",
 CellChangeTimes->{
  3.722631603548936*^9, {3.72263178731949*^9, 3.7226317945699253`*^9}, 
   3.7226358153226852`*^9, 3.722636003074564*^9, {3.722636098299758*^9, 
   3.7226361339468203`*^9}, 3.722636543092005*^9, 3.722636912931631*^9, {
   3.722639235475462*^9, 3.722639288975717*^9}, 3.722640421693211*^9, 
   3.722642192781314*^9, 3.722647003505521*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Dimensions", "[", "Y", "]"}]], "Input",
 CellChangeTimes->{{3.722612452516724*^9, 3.722612455836892*^9}, 
   3.722614778053051*^9, 3.7226314865009193`*^9, 3.722631589682755*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"13", ",", "58"}], "}"}]], "Output",
 CellChangeTimes->{
  3.722631603616044*^9, {3.722631787385087*^9, 3.7226317946563263`*^9}, 
   3.722635815628593*^9, 3.7226360031670227`*^9, {3.7226360984032373`*^9, 
   3.7226361340390987`*^9}, 3.722636543269783*^9, 3.722636913060684*^9, {
   3.722639235577896*^9, 3.7226392891030083`*^9}, 3.72264042188975*^9, 
   3.722642192953648*^9, 3.722647003613864*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{"Print", "[", 
     RowBox[{"CForm", "[", 
      RowBox[{"Extract", "[", 
       RowBox[{"dyn", ",", " ", "i"}], "]"}], "]"}], "]"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"i", ",", " ", "1", ",", " ", "13"}], "}"}]}], "]"}], " ", 
  "*)"}]], "Input",
 CellChangeTimes->{{3.722635899855777*^9, 3.722636010260972*^9}, {
  3.722636065504228*^9, 3.72263608263202*^9}, {3.7226365172660522`*^9, 
  3.722636522064543*^9}, {3.722639217045909*^9, 3.722639231219761*^9}}],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{"Do", "[", 
     RowBox[{
      RowBox[{"Print", "[", 
       RowBox[{"CForm", "[", 
        RowBox[{"A", "[", 
         RowBox[{"[", 
          RowBox[{"row", ",", " ", "col"}], "]"}], "]"}], "]"}], "]"}], ",", 
      " ", 
      RowBox[{"{", 
       RowBox[{"col", ",", " ", "1", ",", " ", "13"}], "}"}]}], "]"}], ",", 
    " ", 
    RowBox[{"{", 
     RowBox[{"row", ",", " ", "1", ",", " ", "13"}], "}"}]}], "]"}], " ", 
  "*)"}]], "Input",
 CellChangeTimes->{{3.722614479459478*^9, 3.7226144837606287`*^9}, 
   3.7226147489729156`*^9, 3.722627861914659*^9, 3.722631503547895*^9, 
   3.722631559724674*^9, 3.722635801069056*^9, {3.722638781244273*^9, 
   3.72263883371325*^9}, {3.7226388647186317`*^9, 3.722638969118868*^9}, {
   3.722639046188601*^9, 3.7226390494371643`*^9}, {3.7226391374753113`*^9, 
   3.722639158333699*^9}, {3.722639201335848*^9, 3.7226392064152822`*^9}, {
   3.722640403364608*^9, 3.722640415412215*^9}}],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{"Do", "[", 
     RowBox[{
      RowBox[{"Print", "[", 
       RowBox[{"CForm", "[", 
        RowBox[{"B", "[", 
         RowBox[{"[", 
          RowBox[{"row", ",", " ", "col"}], "]"}], "]"}], "]"}], "]"}], ",", 
      " ", 
      RowBox[{"{", 
       RowBox[{"col", ",", " ", "1", ",", " ", "6"}], "}"}]}], "]"}], ",", 
    " ", 
    RowBox[{"{", 
     RowBox[{"row", ",", " ", "1", ",", " ", "13"}], "}"}]}], "]"}], " ", 
  "*)"}]], "Input",
 CellChangeTimes->{{3.722614489994322*^9, 3.722614495030719*^9}, {
   3.722614751343567*^9, 3.722614752434146*^9}, 3.722627865446505*^9, 
   3.722631507507608*^9, 3.722631562786538*^9, 3.722635804674555*^9, {
   3.722640428416526*^9, 3.722640436144937*^9}, {3.7226421839782677`*^9, 
   3.72264218766108*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"CForm", "[", "Y", "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.72261450028598*^9, 3.72261450335605*^9}, 
   3.7226147605259743`*^9, 3.7226278687995863`*^9, 3.7226315096198463`*^9, 
   3.722631565993662*^9, 3.722635808422714*^9}]
},
WindowSize->{1871, 1056},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"11.0 for Linux x86 (64-bit) (July 28, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 141, 2, 35, "Input"],
Cell[702, 24, 517, 12, 32, "Input"],
Cell[1222, 38, 477, 11, 32, "Input"],
Cell[1702, 51, 541, 12, 32, "Input"],
Cell[2246, 65, 397, 9, 32, "Input"],
Cell[2646, 76, 342, 8, 32, "Input"],
Cell[2991, 86, 470, 11, 32, "Input"],
Cell[3464, 99, 542, 13, 32, "Input"],
Cell[4009, 114, 509, 13, 32, "Input"],
Cell[4521, 129, 938, 17, 35, "Input"],
Cell[5462, 148, 728, 17, 35, "Input"],
Cell[6193, 167, 823, 17, 69, "Input"],
Cell[7019, 186, 639, 14, 69, "Input"],
Cell[7661, 202, 720, 16, 32, "Input"],
Cell[8384, 220, 596, 15, 32, "Input"],
Cell[8983, 237, 595, 15, 32, "Input"],
Cell[9581, 254, 529, 12, 32, "Input"],
Cell[10113, 268, 352, 7, 32, "Input"],
Cell[10468, 277, 810, 17, 69, "Input"],
Cell[11281, 296, 1221, 27, 32, "Input"],
Cell[12505, 325, 557, 16, 32, "Input"],
Cell[13065, 343, 689, 19, 32, "Input"],
Cell[13757, 364, 740, 20, 32, "Input"],
Cell[14500, 386, 2691, 73, 88, "Input"],
Cell[17194, 461, 2827, 56, 72, "Input"],
Cell[20024, 519, 272, 5, 32, "Input"],
Cell[20299, 526, 603, 14, 32, "Input"],
Cell[20905, 542, 212, 4, 30, "Input"],
Cell[21120, 548, 277, 7, 32, "Input"],
Cell[21400, 557, 346, 8, 32, "Input"],
Cell[21749, 567, 571, 14, 51, "Input"],
Cell[22323, 583, 162, 3, 32, "Input"],
Cell[CellGroupData[{
Cell[22510, 590, 107, 2, 32, "Input"],
Cell[22620, 594, 407, 7, 32, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[23064, 606, 201, 3, 32, "Input"],
Cell[23268, 611, 438, 8, 32, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[23743, 624, 207, 3, 32, "Input"],
Cell[23953, 629, 432, 8, 32, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[24422, 642, 201, 3, 32, "Input"],
Cell[24626, 647, 437, 8, 32, "Output"]
}, Open  ]],
Cell[25078, 658, 547, 13, 35, "Input"],
Cell[25628, 673, 1012, 24, 35, "Input"],
Cell[26643, 699, 833, 22, 35, "Input"],
Cell[27479, 723, 264, 5, 32, "Input"]
}
]
*)

